generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String         @id @default(cuid())
  email        String         @unique
  password     String
  name         String?
  role         Role           @default(USER)
  isBlocked    Boolean        @default(false)
  canPurchase  Boolean        @default(true)
  points       Int            @default(0)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  orders       Order[]
  pointHistory PointHistory[]
  printingJobs PrintingJob[]
}

model PointHistory {
  id          String               @id @default(cuid())
  userId      String
  amount      Int
  type        PointTransactionType
  description String
  createdAt   DateTime             @default(now())
  user        User                 @relation(fields: [userId], references: [id])
}

model Product {
  id                   String      @id @default(cuid())
  sku                  String      @unique
  codigoAlfa           String?
  codigoProducto       String?     @unique
  name                 String
  description          String
  categoria            String?
  subCategoria         String?
  marca                String?
  precio               Decimal
  impuestoInterno      Decimal?
  iva                  Decimal?
  moneda               String?     @default("USD")
  markup               Decimal?
  cotizacion           Decimal?
  pvpUsd               Decimal?
  pvpArs               Decimal?
  peso                 Decimal?
  ean                  String?
  nivelStock           String?
  stockTotal           Int         @default(0)
  stockDepositoCliente Int?        @default(0)
  stockDepositoCd      Int?        @default(0)
  garantia             String?
  link                 String?
  imagen               String?
  miniatura            String?
  atributos            String?
  gamer                Boolean?    @default(false)
  price                Decimal
  stock                Int
  imageUrl             String?
  weight               Decimal?
  dimensions           String?
  categoryId           String?
  provider             String      @default("ELIT") // ELIT or MOBE
  createdAt            DateTime    @default(now())
  updatedAt            DateTime    @updatedAt
  items                OrderItem[]
  category             Category?   @relation(fields: [categoryId], references: [id])
}

model Category {
  id        String     @id @default(cuid())
  name      String     @unique
  slug      String     @unique
  imageUrl  String?
  parentId  String?
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  parent    Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children  Category[] @relation("CategoryHierarchy")
  products  Product[]
}

model Order {
  id              String      @id @default(cuid())
  userId          String
  status          OrderStatus @default(PENDING)
  total           Decimal
  shippingCost    Decimal?
  shippingAddress String?
  shippingZip     String?
  shippingMethod  String?
  paymentId       String?
  paymentStatus   String?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  user            User        @relation(fields: [userId], references: [id])
  items           OrderItem[]
  shipment        Shipment?
}

model OrderItem {
  id        String  @id @default(cuid())
  orderId   String
  productId String
  quantity  Int
  price     Decimal
  product   Product @relation(fields: [productId], references: [id])
  order     Order   @relation(fields: [orderId], references: [id])
}

model Shipment {
  id                String         @id @default(cuid())
  orderId           String         @unique
  trackingNumber    String?        @unique
  carrier           String         @default("Correo Argentino")
  service           String
  cost              Decimal
  status            ShipmentStatus @default(PENDING)
  labelUrl          String?
  estimatedDelivery DateTime?
  metadata          String?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  order             Order          @relation(fields: [orderId], references: [id])
}

model Setting {
  id          String   @id @default(cuid())
  key         String   @unique
  value       String
  description String?
  updatedAt   DateTime @updatedAt
}

enum PointTransactionType {
  EARNED
  REDEEMED
  EXPIRED
  ADMIN_ADJUSTMENT
}

enum Role {
  USER
  ADMIN
}

enum OrderStatus {
  PENDING
  PAID
  SHIPPED
  DELIVERED
  CANCELLED
}

enum ShipmentStatus {
  PENDING
  LABEL_GENERATED
  IN_TRANSIT
  OUT_FOR_DELIVERY
  DELIVERED
  FAILED
  CANCELLED
}

// 3D Printing Jobs
model PrintingJob {
  id          String            @id @default(cuid())
  userId      String
  user        User              @relation(fields: [userId], references: [id])
  title       String
  description String?
  fileUrl     String // Path to the 3D model file
  fileName    String // Original filename
  status      PrintingJobStatus @default(PENDING)
  price       Decimal?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
}

enum PrintingJobStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  DELIVERED
}
